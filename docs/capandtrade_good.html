<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Permit market (cap-and-trade)</title>
    <link href="/css/kg.0.2.0.css" rel="stylesheet" type="text/css">
    <script src="/js/kg.0.2.0.js"></script>
</head>
<!DOCTYPE html>

<style>
body {background-color:#ffffff;background-repeat:no-repeat;background-position:top left;background-attachment:fixed}
h1{font-family:Verdana, sans-serif;color:#000000;}
h2{font-family:Verdana, sans-serif; font-size:15px; color:#000000;background-color:#0394fc;}    
p {font-family:Georgia, serif;font-size:14px;font-style:normal;font-weight:normal;color:#000000;background-color:#ffffff;}
</style>
</head>
    
    <body>

<h1>Permit market (cap-and-trade) </h1>
<!--<h2> and the likely inefficiency of uniform command and control policy </h2>-->
        
<div class="kg-container" style="width: 100%; margin-top: 2em; margin-bottom: 2em;">
schema: EconSchema
aspectRatio: 10
    
    
params:
- name: showauction
  value: false    
- name: showuniform
  value: true
- name: showequilibrium
  value: false
- name: showtrade
  value: false
- name: showcost
  value: false
- name: showoptimal
  value: false
- name: showmd
  value: false    
- name: showtax
  value: false
- name: showdwl
  value: false
- name: showcostsavings
  value: false    
- name: md
  value: 2
  min: 0
  max: 7
  round: 0.01
# this uses inverse, so invert here    
- name: slopemd
  value: 0
  min: 0
  max: 0
  round: 0.01 

    
    
# splitting into A and B (B just keeps old names)    
- name: macslopeA
  value: 0.45
  min: 0.2
  max: 0.65
  round: 0.01
- name: maxinterceptxA
  value: 6
  min: 3
  max: 8    
- name: macslope
  value: 0.6
  min: 0.45
  max: 1.5
  round: 0.01
- name: maxinterceptx
  value: 10
  min: 7
  max: 13    
- name: tax
  value: 1
  min: 0
  max: 7
  round: 0.01
- name: quotatot
  value: 10
  min: 7
  max: 16
  round: 0.5
- name: quotaA
  value: 2
  min: 0
  max: 6
  round: 0.01
    
    
calcs:
#  optimalQuantity: "((10 + params.macslope*(params.md
#    + params.tax))/(1 - params.macslope/params.supplySlope))"
#  macslope is inversed, inverse back
    invmacslopeA: "( 1/ params.macslopeA ) "
    invmacslope: "( 1/ params.macslope ) "

# for MAC aggregation    
    maxA: "(params.macslopeA * params.maxinterceptxA)"
    maxB: "(params.macslope * params.maxinterceptx)"
# point at which only B is producing:
    onlyB: "(params.maxinterceptx - (calcs.maxA /   params.macslope ))"

# slope of aggregated mac   (the last part is onlyb .. doesn't work if use directly)
    macslopetot:  "(calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) ))"
    invmacslopetot: "(1 / (calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) )"
    maxinterceptxtot: "(params.maxinterceptx+params.maxinterceptxA)"
    ACmaxA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA  )"
  
    
#  market equilibrium:
    price: "((calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) * (calcs.maxinterceptxtot  - params.quotatot) )"
    
    # for quotas:
    fixedquotaA: "(params.quotatot / 2)"
    fixedquotaB: "(params.quotatot / 2)"
#QQ how to put a lower bound  (doesn't work)
    MACfixedquotaA: "(params.maxinterceptxA * params.macslopeA -  params.macslopeA * calcs.fixedquotaA )"
    MACfixedquotaA_: "(calcs.MACfixedquotaA_ >params.maxinterceptxA ?  : calcs.MACfixedquotaA_)"
    MACfixedquotaB: "(params.maxinterceptx * params.macslope -  params.macslope * calcs.fixedquotaB )"
    ACfixedquotaA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.fixedquotaA + (params.macslopeA) /2 * calcs.fixedquotaA^2 )"
    ACfixedquotaB: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.fixedquotaB + (params.macslope) /2 * calcs.fixedquotaB^2 )"
    ACfixedquotatot: "(calcs.ACfixedquotaA + calcs.ACfixedquotaB  )"
    
    quotaB: "(params.quotatot - params.quotaA)"
    MACquotaA: "(params.maxinterceptxA * params.macslopeA -  params.macslopeA * params.quotaA )"
    MACquotaB: "(params.maxinterceptx * params.macslope -  params.macslope * (params.quotatot - params.quotaA) )"
    ACquotaA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*params.quotaA + (params.macslopeA) /2 * params.quotaA^2 )"
    ACquotaB: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*(params.quotatot - params.quotaA) + (params.macslope) /2 * (params.quotatot - params.quotaA)^2 )"
    ACquotatot: "(calcs.ACquotaA + calcs.ACquotaB  )"
    
    #  mdslope is inversed, inverse back
    invmdslope: "( 1/ params.slopemd ) "
#    optimalQuantity: "(params.maxinterceptx - (params.md / params.macslope))"
    optimalQuantity: "((params.maxinterceptx * params.macslope -  params.md)/( params.slopemd + params.macslope))"
    optimalQuantityA: "((params.maxinterceptxA * params.macslopeA -  params.md)/( params.slopemd + params.macslopeA))"
    
    # if statament doesnt work here, workaround below:
#    optimalQuantitytot_: "((calcs.maxinterceptxtot * calcs.macslopetot -  params.md)/( params.slopemd + calcs.macslopetot))"
#    also, have to copy everything back in:
    optimalQuantitytot: "(((params.maxinterceptx+params.maxinterceptxA) * (calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) -  params.md)/( params.slopemd + (calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) ))))"    
 
    
    optimalDamages: "(params.md * calcs.optimalQuantity + params.slopemd /2 * calcs.optimalQuantity^2  )"
    optimalAC: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.optimalQuantity + (params.macslope) /2 * calcs.optimalQuantity^2 )"
    maxAC: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx )"
    
    #optimalCosts: "(calcs.optimalDamages + calcs.optimalAC)"
    # QQ why can't I add the two directly?
    optimalCosts: "((params.md * calcs.optimalQuantity + params.slopemd /2 * calcs.optimalQuantity^2  ) + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.optimalQuantity + (params.macslope) /2 * calcs.optimalQuantity^2 ))"
    
    # for tax / permit
    
    # equilibriumQuantity = with tax
    # permitQuantity = with permit market
    
    
    equilibriumQuantity: "((params.maxinterceptx * params.macslope -  params.tax)/( params.macslope))"
    equilibriumQuantityA: "((params.maxinterceptxA * params.macslopeA -  params.tax)/( params.macslopeA))"
   
    # here, copying price inside
    permitQuantity: "((params.maxinterceptx * params.macslope -  ((calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) * (calcs.maxinterceptxtot  - params.quotatot) ))/( params.macslope))"
    
    permitQuantityA: "((params.maxinterceptxA * params.macslopeA -  ((calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) * (calcs.maxinterceptxtot  - params.quotatot) ))/( params.macslopeA))"
    
    permitQuantitytot: "(((params.maxinterceptxA * params.macslopeA -  ((calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) * (calcs.maxinterceptxtot  - params.quotatot) ))/( params.macslopeA)) +((params.maxinterceptx * params.macslope -  ((calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) * (calcs.maxinterceptxtot  - params.quotatot) ))/( params.macslope)))"
    
    
    
    
    equilibriumQuantitytot: "(((params.maxinterceptx+params.maxinterceptxA) * (calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) )) -  params.tax)/( (calcs.maxA  / (params.maxinterceptxA + params.maxinterceptx - (params.maxinterceptx - (calcs.maxA /   params.macslope )) ))))"
    
    equilibriumQuantitytot_: "(calcs.equilibriumQuantitytot_ > calcs.onlyB ? calcs.equilibriumQuantitytot_ : calcs.equilibriumQuantity)"
    
    
    equilibriumDamages: "(params.md * calcs.equilibriumQuantity  + params.slopemd /2 * calcs.equilibriumQuantity^2  )"
  
    equilibriumAC: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.equilibriumQuantity + (params.macslope) /2 * calcs.equilibriumQuantity^2 )"
    
    equilibriumACmax: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx)" 
    
    equilibriumACA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.equilibriumQuantityA + (params.macslopeA) /2 * calcs.equilibriumQuantityA^2 )"
    
    equilibriumACAmax: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA)" 
    
    equilibriumACtot: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.equilibriumQuantityA + (params.macslopeA) /2 * calcs.equilibriumQuantityA^2 )  + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.equilibriumQuantity + (params.macslope) /2 * calcs.equilibriumQuantity^2 )"
    
    equilibriumACtotmax: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA   + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx  ))"
    
    permitAC: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.permitQuantity + (params.macslope) /2 * calcs.equilibriumQuantity^2 )"
    
    permitACmax: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx)" 
    
    permitACA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.permitQuantityA + (params.macslopeA) /2 * calcs.permitQuantityA^2 )"
    
    permitACAmax: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA)" 
    
    permitACtot: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.permitQuantityA + (params.macslopeA) /2 * calcs.permitQuantityA^2 )  + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.permitQuantity + (params.macslope) /2 * calcs.permitQuantity^2 )"
    
    permitACtotmax: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA   + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx  ))"
    
    uniformAC: "((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.fixedquotaB + (params.macslope) /2 * calcs.fixedquotaB^2 )"
    
    
    uniformACA: "((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.fixedquotaA + (params.macslopeA) /2 * calcs.fixedquotaA^2 )"
    
    uniformACtot: " (((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.fixedquotaB + (params.macslope) /2 * calcs.fixedquotaB^2 ) + 
    ((params.macslopeA) /2 *params.maxinterceptxA * params.maxinterceptxA - (params.macslopeA) * params.maxinterceptxA*calcs.fixedquotaA + (params.macslopeA) /2 * calcs.fixedquotaA^2 ))
    "
        
    equilibriumCosts: "(((params.md * calcs.equilibriumQuantity  + params.slopemd /2 * calcs.equilibriumQuantity^2  ) + ((params.macslope) /2 *params.maxinterceptx * params.maxinterceptx - (params.macslope) * params.maxinterceptx*calcs.equilibriumQuantity + (params.macslope) /2 * calcs.equilibriumQuantity^2 )))"
    
    dwl: "(calcs.equilibriumCosts - calcs.optimalCosts)"
    
    
layout:
  ThreeHorizontalGraphs:
    #  ThreeHorizontalGraphs:
 
    leftGraph:
      xAxis: 
        title: Pollution A (quantity)
        orient: bottom
        min: 0
        max: 16
      yAxis: 
        title: Cost (\$ per unit)
        orient: left
        min: 0
        max: 7
      objects:
      - EconLinearSupply:
          name: MD
          yIntercept: params.md
          slope: 0
          label: 
            text: MD
            x : 14
          color: colors.green
          handles: true
          draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
          show: params.showoptimal
          
    
    
      - Area:
         univariateFunction1: 
             fn:  params.md + params.slopemd * x
             ind: x
             max: calcs.optimalQuantityA
         fill: colors.green
         opacity: 0.1
         show: params.showoptimal
                                         
    
      - EconLinearDemand:
          name: MACA
          xIntercept: params.maxinterceptxA
          invSlope: -calcs.invmacslopeA
          label: 
            text: MAC^A
            x : (0.8 * params.maxinterceptxA)
          color: colors.red
          handles: true
          draggable: true
          drag:
            - vertical: yIntercept
     #     strokeWidth: 4
    #       show: params.showExt
    
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.maxA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showauction
      
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: calcs.optimalQuantityA
         fill: colors.red
         opacity: 0.1
         show: params.showoptimal
    
    
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantityA > 0) ? calcs.optimalQuantityA : 0)
            - calcs.optimalQuantityA 
            - params.md + calcs.optimalQuantityA * params.slopemd
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantityA > 0)  && params.showoptimal
 
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.md
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantityA < 0)  && params.showoptimal

# equilibrium:
      
       # price
      - EconLinearSupply:
          name: price
          yIntercept: calcs.price
          invSlope: 9999
          color: colors.blue
          lineStyle: dotted
          label: 
            text: "`Price^* = ${calcs.price.toFixed(1)}`"
            x : 13                                   
          show: params.showtrade                                       
                                           
                                           
      - Point:
          coordinates:
           - 0
           - calcs.price 
          lineStyle: dotted
          color: blue
          droplines:
            horizontal:  MAC^A
          show: params.showtrade                                       
 
                                           
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.permitQuantityA 
            - calcs.price
          lineStyle: dotted
          color: grey
          droplines:
            vertical: P^0
          show: params.showtrade                                                
                                            
        
      - Arrow:
         begin: [calcs.fixedquotaA,6]
         end: [calcs.permitQuantityA,6]
         color: blue
         trim: 0.1
         show: params.showtrade
    
    # for label
      - Arrow:
         begin: [calcs.fixedquotaA,6.3]
         end: [calcs.permitQuantityA,6.3]
         color: blue
         label:
           text: Q^{sold}
         trim: 0.1
         show: params.showtrade
    
   
    
    
    # + grey line to go to arrow
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.permitQuantityA 
            - 600
          lineStyle: dotted
          color: grey
          droplines:
            vertical: P^0_{permit}
          show: params.showtrade    
    
    
    
 # start quotas stuff:    
                                            
      - EconLinearDemand:
          name: MACB
          xIntercept: calcs.fixedquotaA
          invSlope: -0.0001
          label: 
            text: MAC^B
            x : 1
          color: colors.grey
          handles: true
          draggable: true
          drag:
            - vertical: yIntercept
     #     strokeWidth: 4
          show: params.showuniform
    
                                            
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.MACfixedquotaA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showuniform                                        
                                            
      - Point:
          coordinates:
           - calcs.fixedquotaA
           - 100
          lineStyle: full
          color: black
          droplines:
            vertical: \bar{Q}^A_{uniform}
          show: params.showuniform

      - Point:
          coordinates:
           - calcs.fixedquotaA
           - calcs.MACfixedquotaA 
          lineStyle: full
          color: black
          droplines:
            horizontal: MAC^A 
          show: params.showuniform
    
      
    
       
    #costincrease A 
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: params.quotaA
             max: calcs.fixedquotaA     
         fill: colors.red
         opacity: 0.7
         show:  params.showcostsavings     
    
    #costincrease B 
      - Area:
         univariateFunction1: 
             fn: calcs.MACB.yIntercept  + calcs.MACB.slope*(x)
             min: calcs.fixedquotaB
             max: calcs.quotaB     
         fill: colors.green
         opacity: 0.7
         show:  params.showcostsavings

    
# start tax stuff:
      - EconLinearSupply:
          name: taxline
          yIntercept: params.tax
          slope: 0
          label: 
            text: "`Tax = ${params.tax.toFixed(1)}`"
            x : 8.5
          color: colors.orange
          handles: true
          draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
          show:  params.showtax
    
    
      - Area:
         univariateFunction1: 
             fn:  calcs.MD.yIntercept  + calcs.MD.slope*(x)
             max: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.1
         labels: 
            text: C^0                               
            x: 3                               
         show:  params.showcost
                               
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.1
         show:  params.showcost                                   
 
# deadweight loss:
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: calcs.optimalQuantityA
             max: calcs.equilibriumQuantityA
         univariateFunction2: 
             fn: params.md + params.slopemd * x 
             min: calcs.optimalQuantityA
             max: calcs.equilibriumQuantityA                                   
         fill: colors.orange
         opacity: 0.7
         show:  params.showtax  && params.showdwl                                
                                           
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantityA > 0) ? calcs.optimalQuantityA : 0)
            - calcs.equilibriumQuantityA 
            - params.tax
          lineStyle: dotted
          color: grey
          droplines:
            vertical: P^0_{tax}
          show: (calcs.equilibriumQuantityA > 0) && params.showtax
 
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.tax
          lineStyle: dotted
          droplines:
      #      horizontal: P^E_C
            vertical: P^0_{tax}
          show: (calcs.equilibriumQuantityA < 0)   &&  params.showtax                                           
    # controls                                     
    leftControls:
      title: Options
      description: "Add the following elements to the graph:"                                        
      checkboxes: 
              - param: showuniform
                label: "\\text{1 - Equal distribution of non-tradeable permits}" 
              - param: showequilibrium
                label: "\\text{2 - Tradeable permits and equilibrium price}" 
              - param: showtrade
                label: "\\text{3 - Equibrium pollution and quantity traded}" 
              - param: showtax
                label: "\\text{Compare to pollution tax}" 
              - param: showauction
                label: "\\text{If permits are auctionned?}"                                     
                                                
                                                
              
 ##########################              
    
    middleGraph:
      xAxis: 
        title: Pollution B (quantity)
        orient: bottom
        min: 0
        max: 16
      yAxis: 
        title: Cost (\$ per unit)
        orient: left
        min: 0
        max: 7
      objects:
      - EconLinearSupply:
          name: MD
          yIntercept: params.md
          slope: 0
          label: 
            text: MD
            x : 14
          color: colors.green
          handles: true
          draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
          show: params.showoptimal
          
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.maxA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted 
          show: params.showauction
    
      - Area:
         univariateFunction1: 
             fn:  params.md + params.slopemd * x
             ind: x
             max: calcs.optimalQuantity
         fill: colors.green
         opacity: 0.1
         show: params.showoptimal
        
      - EconLinearDemand:
          name: MACB
          xIntercept: params.maxinterceptx
          invSlope: -calcs.invmacslope
          label: 
            text: MAC^B
            x : (0.2 * params.maxinterceptx)
          color: colors.red
          handles: true
          draggable: true
          drag:
            - vertical: yIntercept
     #     strokeWidth: 4
    #       show: params.showExt


      - Area:
         univariateFunction1: 
             fn: calcs.MACB.yIntercept  + calcs.MACB.slope*(x)
             min: calcs.optimalQuantity
         fill: colors.red
         opacity: 0.1
         show: params.showoptimal
    
    
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.optimalQuantity 
            - params.md + calcs.optimalQuantity * params.slopemd
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantity > 0)  && params.showoptimal
 
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.md
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantity < 0)  && params.showoptimal
                                
 # start quota stuff
                                           
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.MACfixedquotaA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showuniform      
                                           
  
      - EconLinearDemand:
          name: MACB
          xIntercept: calcs.fixedquotaB
          invSlope: -0.0001
          label: 
            text: MAC^B
            x : 1
          color: colors.grey
          handles: true
          draggable: true
          drag:
            - vertical: yIntercept
     #     strokeWidth: 4
          show: params.showuniform
    
                                            
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.MACfixedquotaB
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showuniform                                        
                                            
      - Point:
          coordinates:
           - calcs.fixedquotaB
           - 100
          lineStyle: full
          color: black
          droplines:
            vertical: \bar{Q}^B_{uniform}
          show: params.showuniform

      - Point:
          coordinates:
           - calcs.fixedquotaB
           - calcs.MACfixedquotaB 
          lineStyle: full
          color: black
          droplines:
            horizontal: MAC^B 
          show: params.showuniform                                           
 
 # equilibrium:
      
    # price
      - EconLinearSupply:
          name: price
          yIntercept: calcs.price
          invSlope: 9999
          color: colors.blue
          lineStyle: dotted
          label: 
            text: Price^*
            x : 14                                   
          show: params.showtrade                                        
                                           
                                           
      - Point:
          coordinates:
           - 0
           - calcs.price 
          lineStyle: dotted
          color: blue
          droplines:
            horizontal:  MAC^B
          show: params.showtrade                                        
    
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.permitQuantity 
            - calcs.price
          lineStyle: dotted
          color: grey
          droplines:
            vertical: P^0_{permit}
          show: params.showtrade                                           
                                            
        
      - Arrow:
         begin: [calcs.fixedquotaB,6]
         end: [calcs.permitQuantity,6]
         color: blue
         trim: 0.1
         show: params.showtrade
    
    # for label
      - Arrow:
         begin: [calcs.fixedquotaB,6.3]
         end: [calcs.permitQuantity,6.3]
         color: blue
         label:
           text: Q^{bought}
           trim: 0.1
         show: params.showtrade
    
    
    # + grey line to go to arrow
      - Point:
          coordinates:
            - calcs.permitQuantity 
            - 600
          lineStyle: dotted
          color: grey
          droplines:
            vertical: 
          show: params.showtrade        
                                           
# start tax stuff:
      - EconLinearSupply:
          name: taxline
          yIntercept: params.tax
          slope: 0
          label: 
            text: "`Tax `"
            x : 2
          color: colors.orange
          handles: true
          draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
          show:  params.showtax
    
    
      - Area:
         univariateFunction1: 
             fn:  calcs.MD.yIntercept  + calcs.MD.slope*(x)
             max: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.1
         labels: 
            text: C^0                               
            x: 3                               
         show:  params.showcost
                               
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.1
         show:  params.showcost                                   
 
# deadweight loss:
      - Area:
         univariateFunction1: 
             fn: calcs.MACB.yIntercept  + calcs.MACB.slope*(x)
             min: calcs.optimalQuantity
             max: calcs.equilibriumQuantity
         univariateFunction2: 
             fn: params.md + params.slopemd * x 
             min: calcs.optimalQuantity
             max: calcs.equilibriumQuantity                                   
         fill: colors.orange
         opacity: 0.7
         show:  params.showtax  && params.showdwl                                
                                           
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.equilibriumQuantity 
            - params.tax
          lineStyle: dotted
          color: grey
          droplines:
            vertical: P^0_{tax}
          show: (calcs.equilibriumQuantity > 0)  &&  params.showtax        
 
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.tax
          lineStyle: dotted
          droplines:
      #      horizontal: P^E_C
            vertical: P^0_{tax}
          show: (calcs.equilibriumQuantity < 0)   &&  params.showtax                                           
    # controls                                     
    middleControls:
      title: Settings
      sliders:
           - param: quotatot
             label: "\\text{Total permits}"

           - param: macslopeA
             label: "\\text{A: MAC slope}"
           - param: maxinterceptxA
             label: "\\text{A: Max pollution} "                                    
           - param: macslope
             label: "\\text{B: MAC slope}"
           - param: maxinterceptx
             label: "\\text{B: Max pollution} "  
           - param: tax
             label: "\\text{Tax}" 
             show: params.showtax                               
          # - param: md
          #     label: "\\text{MD}"
        #     show: params.showoptimal           
  ##########################              
    
    rightGraph:
      xAxis: 
        title: "Permit market: quantity traded" 
        orient: bottom
        min: 0
        max: 16
      yAxis: 
        title: Cost (\$ per unit)
        orient: left
        min: 0
        max: 7
      objects:
      - EconLinearSupply:
          name: MD
          yIntercept: params.md
          slope: 0
          label: 
            text: MD
            x : 14
          color: colors.green
          handles: true
          draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
          show: params.showoptimal
      
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.maxA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted                                       
          show: params.showauction
    
      - Area:
         univariateFunction1: 
             fn:  params.md + params.slopemd * x
             ind: x
             max: calcs.optimalQuantity
         fill: colors.green
         opacity: 0.1
         show: params.showoptimal && (calcs.optimalQuantitytot < calcs.onlyB       )      
        
      - Area:
         univariateFunction1: 
             fn:  params.md + params.slopemd * x
             ind: x
             max: calcs.optimalQuantitytot
         fill: colors.green
         opacity: 0.1
         show: params.showoptimal && (calcs.optimalQuantitytot > calcs.onlyB       )  
         
  # aggregated MAC:
  # both are abating  
      - EconLinearDemand:
          name: MACtot
          xIntercept: calcs.maxinterceptxtot
          invSlope: -calcs.invmacslopetot
          min: calcs.onlyB
          label: 
            text: MAC^{total}
            x : (0.8 * calcs.maxinterceptxtot)
          color: colors.red
          show: params.showauction
     
      - Line:
          xIntercept: params.maxinterceptx
          yIntercept: calcs.maxB
          color: colors.red  
          max : calcs.onlyB                                       
        #  areaBelow: {fill: green, opacity: 0.5, min: 3}
          show: params.showauction
    
      - Area:
         univariateFunction1: 
             fn: calcs.MACtot.yIntercept  + calcs.MACtot.slope*(x)
             min: calcs.optimalQuantity
         fill: colors.red
         opacity: 0.1
         show: params.showoptimal && (calcs.optimalQuantitytot < calcs.onlyB       )                                              
                       
      - Area:
         univariateFunction1: 
             fn: calcs.MACtot.yIntercept  + calcs.MACtot.slope*(x)
             min: calcs.optimalQuantitytot
         fill: colors.red
         opacity: 0.1
         show: params.showoptimal && (calcs.optimalQuantitytot > calcs.onlyB       )
      
      - Area:
         univariateFunction1: 
             fn: calcs.MACtot.yIntercept  + calcs.MACtot.slope*(x)
             min: calcs.optimalQuantity  
             max: calcs.onlyB
         univariateFunction2: 
             fn: calcs.MACB.yIntercept  + calcs.MACB.slope*(x)
             min: calcs.optimalQuantity 
             max: calcs.onlyB
         fill: colors.red
         opacity: 0.1
         show: params.showoptimal && (calcs.optimalQuantitytot < calcs.onlyB       )
 
             
    
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.optimalQuantitytot 
            - params.md + calcs.optimalQuantitytot * params.slopemd
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantity > 0)  && params.showoptimal && (calcs.optimalQuantity > calcs.onlyB) 
 
      - Point:
          coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
            - calcs.optimalQuantity
            - params.md + calcs.optimalQuantity * params.slopemd
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantity > 0)  && params.showoptimal && (calcs.optimalQuantity < calcs.onlyB) 
    
    
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.md
          lineStyle: dotted
          color: grey
          droplines:
      #      horizontal: P^E_C
            vertical: P^*
          show: (calcs.optimalQuantity < 0)  && params.showoptimal
         
    
    
    
 # start quota stuff
                                           
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.MACfixedquotaA
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showuniform      
  
      - EconLinearSupply:
          name: maxA
          yIntercept: calcs.MACfixedquotaB
          invSlope: 9999
          color: colors.grey
          lineStyle: dotted
          show: params.showuniform

      - Point:
          coordinates:
            - calcs.fixedquotaA
            - calcs.maxA
          lineStyle: dotted
          color: grey
          droplines:
            vertical: \bar{Q}^A_{uniform}
          show: params.showequilibrium   


# start market equilibrium stuff:    
    
     
    
      - EconLinearEquilibrium:
          name: marketequilibrium
          demand: 
            name: ourDemand
            xIntercept: (params.maxinterceptx - calcs.fixedquotaB)
            invSlope: -calcs.invmacslope
            color: colors.blue
            label: 
               text: \text{Demand (from B)}        
               y : 0.4
            show: params.showequilibrium
               
          supply: 
            name: ourSupply
            yIntercept: calcs.MACfixedquotaA
            slope: (params.macslopeA)
            max: calcs.fixedquotaA
            color: colors.blue
            label: 
              text: \text{Supply (from A)}                               
              x: calcs.fixedquotaA   
              position: tr
            show: params.showequilibrium
          
    
          equilibrium:
            color: colors.blue
            droplines:
              vertical: Q^{traded}
             # horizontal: "`P^* = ${calcs.marketequilibrium.P.toFixed(2)}`"
             # horizontal: "`P^*`"
            show: params.showtrade
    
    # show price separately:
    
      - Point:
          coordinates:
           - 1000
           - calcs.price 
          lineStyle: dotted
          color: blue
          droplines:
            horizontal: Price^* 
          show: params.showequilibrium                                        
    
 # text box:
      - Rectangle:
          a: [6,6]
          b: [13, 5.5]
          color: blue
          label: 
            text:  \text{Permits are tradeable} 
          show: params.showequilibrium  && !params.showtax
    
      - Rectangle:
          a: [6,5]
          b: [13,5.5]
          color: blue
          label: 
            text:  "`Price^*  = ${calcs.price.toFixed(1)}`"
          show: params.showequilibrium  && !params.showtax
    
      - Rectangle:
          a: [6,4]
          b: [13, 4.5]
          color: blue
          label: 
            text:  \text{A sells to B}
          show: params.showtrade && !params.showtax
      - Rectangle:
          a: [6,4.5]
          b: [13, 5]
          color: blue
          label: 
            text: "`Q^{traded}  = ${(calcs.fixedquotaA - calcs.permitQuantityA ).toFixed(1) }`"
          show: params.showtrade && !params.showtax
    
    
    
      - Rectangle:
          a: [6,3.5]
          b: [13, 4]
          color: blue
          label: 
            text: "`MAC^A = MAC^B`"
          show: params.showtrade && !params.showtax
    
      - Rectangle:
          a: [1,5]
          b: [14,5.5]
          color: black
          label: 
            text:  \text{Permits are equally distributed to A and B }
          show: ((!params.showequilibrium)  && params.showuniform && !params.showtax)
    
      - Rectangle:
          a: [1,4.5]
          b: [14, 5]
          color: black
          label: 
            text:  \text{Permits are non-tradeable}
          show: (!params.showequilibrium  && params.showuniform && !params.showtax)
      - Rectangle:
          a: [1,4]
          b: [14, 4.5]
          color: black
          label: 
            text:  "` Q^{A}_{uniform} +  Q^{B}_{uniform} = ${(params.quotatot).toFixed(2) } `"
          show: (!params.showequilibrium  && params.showuniform && !params.showtax)
    
    
      - Rectangle:
          a: [1,3.5]
          b: [14,4]
          color: black
          label: 
            text: \text{(adjust in settings below) }
            color : black
          show: (!params.showequilibrium  && params.showuniform && !params.showtax)
    
      - Rectangle:
          a: [0.3,5.5]
          b: [14.7,5]
          color: orange
          label: 
            text: \text{Find the tax level which yields the same abatement  }
            color : black
          show: params.showtax
    
      - Rectangle:
          a: [0.3,5]
          b: [14.7,4.5]
          color: orange
          label: 
            text: \text{and compare total abatement costs }
            color : black
          show: params.showtax
    
# start tax stuff:
    
    # don't show in this graph:
    
    #  - EconLinearSupply:
    #      name: taxline
    #      yIntercept: params.tax
    #      slope: 0
    #      label: 
    #        text: "`Tax `"
    #        x : 2
    #      color: colors.orange
    #      handles: true
    #      draggable: true
     #     areaBelow: {fill: green, opacity: 0.1, max: 2}
     #     strokeWidth: 4
     #     show:
    
    
      - Area:
         univariateFunction1: 
             fn:  calcs.MD.yIntercept  + calcs.MD.slope*(x)
             max: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.9
         labels: 
            text: C^0                               
            x: 3                               
         show:  params.showcost
                               
      - Area:
         univariateFunction1: 
             fn: calcs.MACA.yIntercept  + calcs.MACA.slope*(x)
             min: calcs.equilibriumQuantity
         fill: colors.blue
         opacity: 0.9
         show:  params.showcost                                   
   
  
                                                                                  
# deadweight loss:
      - Area:
         univariateFunction1: 
             fn: calcs.MACtot.yIntercept  + calcs.MACtot.slope*(x)
             min: calcs.optimalQuantitytot
             max: calcs.equilibriumQuantitytot
         univariateFunction2: 
             fn: params.md + params.slopemd * x 
             min: calcs.optimalQuantitytot
             max: calcs.equilibriumQuantitytot                                   
         fill: colors.orange
         opacity: 0.7
         show:  params.showtax  && params.showdwl  && (calcs.optimalQuantitytot > calcs.onlyB)                              
      - Area:
         univariateFunction1: 
             fn: calcs.MACtot.yIntercept  + calcs.MACtot.slope*(x)
             min: calcs.onlyB
             max: calcs.equilibriumQuantitytot
         univariateFunction2: 
             fn: params.md + params.slopemd * x 
             min: calcs.onlyB
             max: calcs.equilibriumQuantitytot                                   
         fill: colors.orange
         opacity: 0.7
         show:  params.showtax  && params.showdwl  && (calcs.optimalQuantitytot < calcs.onlyB)       
    
    
      - Area:
         univariateFunction1: 
             fn: calcs.MACB.yIntercept  + calcs.MACB.slope*(x)
             min: calcs.optimalQuantitytot
             max: calcs.onlyB
         univariateFunction2: 
             fn: params.md + params.slopemd * x 
             min: calcs.optimalQuantitytot
             max: calcs.onlyB                                 
         fill: colors.blue
         opacity: 0.9
         show:  params.showtax  && params.showdwl  && (calcs.optimalQuantitytot <= calcs.onlyB)          
    # don't show here
    #  - Point:
    #      coordinates:
     #   #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
    #        - calcs.equilibriumQuantitytot 
    #        - params.tax
    #      lineStyle: dotted
    #      color: grey
    #      droplines:
    #        vertical: P^0
    #      show: (calcs.equilibriumQuantity > 0) && (calcs.equilibriumQuantitytot > calcs.onlyB)
                                            
    #  - Point:
    #      coordinates:
        #   - ( (calcs.optimalQuantity > 0) ? calcs.optimalQuantity : 0)
    #       - calcs.equilibriumQuantity 
    #        - params.tax
    #      lineStyle: dotted
    #      color: grey
    #      droplines:
    #        vertical: P^0
    ##      show: (calcs.equilibriumQuantity > 0) && (calcs.equilibriumQuantitytot < calcs.onlyB)
 
# when corner solution
      - Point:
          coordinates:
           - 0
           - params.tax
          lineStyle: dotted
          droplines:
      #      horizontal: P^E_C
            vertical: P^0
          show: (calcs.equilibriumQuantity < 0)   &&  params.showtax                                           
    # controls                                     
       
    rightControls:
      title: Outcomes 
      divs:
        # with tax only   : "equilibrium"
            #
           # - html: "`   DOESNT WORK
        #      <table style='margin-left:auto; margin-right:auto; font-size:10pt; text-    align:center; border-collapse:collapse;' cellpadding='2px'><thead style='border-bottom:0.5pt solid gray'><tr><td>&nbsp;Quintile&nbsp;</td><td>&nbsp;Avg. Income&nbsp;</td><td>&nbsp;Share of Income&nbsp;</td></tr></thead><tbody><tr style='color:${colors.red}'><td>Bottom</td><td>1</td><td>2</td></tr><tr style='color:${colors.orange}'><td>Second</td><td>3</td><td>4</td></tr><tr style='color:${colors.grey}'><td>Middle</td><td>4</td><td>4</td></tr><tr style='color:${colors.blue}'><td>Fourth</td><td>4</td><td>4</td></tr><tr style='color:${colors.green}'><td>Top</td><td>4</td><td>4</td></tr><tr style='border-top:0.5pt solid gray'><td>Total</td><td>4<td></tr></tbody></table>  `"
    #
            - html: "` <u> With pollution tax </u> <br>
              Pollution  $P^{0}$:   A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  params.maxinterceptxA : 
              calcs.equilibriumQuantityA.toFixed(1)) : 0)};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  params.maxinterceptx : 
              calcs.equilibriumQuantity.toFixed(1)) : 0)};
              <b> Tot = ${(calcs.equilibriumQuantitytot  > 0 ?   
              (calcs.equilibriumQuantitytot >= params.maxinterceptxtot ?  params.maxinterceptxtot : 
              calcs.equilibriumQuantitytot.toFixed(1)) : 0)}$$ </b>  <br>
    
              Abatement: A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  0 : 
              (params.maxinterceptxA - calcs.equilibriumQuantityA).toFixed(1)) :  params.maxinterceptxA )};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  0 : 
              (params.maxinterceptx - calcs.equilibriumQuantity).toFixed(1)) : params.maxinterceptx )}; 
              Tot = ${(calcs.equilibriumQuantitytot  > 0 ?   
              (calcs.equilibriumQuantitytot >= params.maxinterceptxtot ? 0 : 
              (calcs.maxinterceptxtot - calcs.equilibriumQuantitytot).toFixed(1)) : params.maxinterceptxtot )}$$  <br>
    
              &nbsp  - share of max.:  A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  0 : 
              ((params.maxinterceptxA - calcs.equilibriumQuantityA) /params.maxinterceptxA) .toFixed(1)) :  1 )};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  0 : 
              ((params.maxinterceptx - calcs.equilibriumQuantity)/params.maxinterceptx).toFixed(1)) : 1)};
              Tot = ${(calcs.equilibriumQuantitytot  > 0 ?   
              (calcs.equilibriumQuantitytot >= params.maxinterceptxtot ? 0 : 
              ((calcs.maxinterceptxtot - calcs.equilibriumQuantitytot)/calcs.maxinterceptxtot).toFixed(1)) : 1 )}$$
              <br> <br>
              Abatement costs for A: $\\\\ $${(calcs.equilibriumACA.toFixed(1)  > 0 ?  calcs.equilibriumACA.toFixed(1) : 0 )}<br>
              Abatement costs for B: $\\\\ $${(calcs.equilibriumAC.toFixed(1)  > 0 ?  calcs.equilibriumAC.toFixed(1) : 0 )}<br>
              <b> Total abatement costs: $\\\\ $${(calcs.equilibriumACtot.toFixed(1)  > 0 ?  calcs.equilibriumACtot.toFixed(1) : 0 )}$$ </b>
              `" 
              show: (calcs.equilibriumQuantitytot > calcs.onlyB)  && (params.showtax)
   
    
    
    # now the same if onlyB
            - html: "`   <u> With pollution tax </u> <br>
              Pollution  $P^{0}$: A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  params.maxinterceptxA : 
              calcs.equilibriumQuantityA.toFixed(1)) : 0)};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  params.maxinterceptx : 
              calcs.equilibriumQuantity.toFixed(1)) : 0)};
              <b> Tot = ${(calcs.equilibriumQuantitytot  > 0 ?   
              (calcs.equilibriumQuantitytot >= params.maxinterceptxtot ?  params.maxinterceptxtot : 
              calcs.equilibriumQuantity.toFixed(1)) : 0)}$$ </b>  <br>
    
              Abatement:   A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  0 : 
              (params.maxinterceptxA - calcs.equilibriumQuantityA).toFixed(1)) :  params.maxinterceptxA )};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  0 : 
              (params.maxinterceptx - calcs.equilibriumQuantity).toFixed(1)) : params.maxinterceptx )};
              Tot = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ? 0 : 
              (params.maxinterceptx - calcs.equilibriumQuantity).toFixed(1)) : params.maxinterceptx )}$$  <br>
    
              &nbsp  - share of max.:  A =$\\\\ $${(calcs.equilibriumQuantityA  > 0 ?   
              (calcs.equilibriumQuantityA >= params.maxinterceptxA ?  0 : 
              ((params.maxinterceptxA - calcs.equilibriumQuantityA) /params.maxinterceptxA) .toFixed(1)) :  1 )};
              B = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ?  0 : 
              ((params.maxinterceptx - calcs.equilibriumQuantity)/params.maxinterceptx).toFixed(1)) : 1)};
              Tot = ${(calcs.equilibriumQuantity  > 0 ?   
              (calcs.equilibriumQuantity >= params.maxinterceptx ? 0 : 
              ((calcs.maxinterceptxtot - calcs.equilibriumQuantity)/calcs.maxinterceptxtot).toFixed(1)) : 1 )}$$<br> <br>
              Abatement costs for A:$\\\\ $${(calcs.equilibriumACA.toFixed(1)  > 0 ?  calcs.equilibriumACAmax.toFixed(1) : 0 )}; <br>
              Abatement costs for B:$\\\\ $${(calcs.equilibriumACmax.toFixed(1)  > calcs.equilibriumAC.toFixed(1) ?  calcs.equilibriumAC.toFixed(1) : calcs.equilibriumACmax.toFixed(1) )}; <br>
              <b> Total abatement costs: $\\\\ $${(calcs.equilibriumACtotmax.toFixed(1)  > calcs.equilibriumACtot.toFixed(1) ?  calcs.equilibriumACtot.toFixed(1) : calcs.equilibriumACtotmax.toFixed(1)  )}$$ </b>
              `" 
              show: (calcs.equilibriumQuantitytot < calcs.onlyB)  && params.showtax
    
    ## for permit
            - html: "` <u> With tradeable permits </u>  <br>
              Pollution  $P^{0}$:   A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  params.maxinterceptxA : 
              calcs.permitQuantityA.toFixed(1)) : 0)};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  params.maxinterceptx : 
              calcs.permitQuantity.toFixed(1)) : 0)};
              <b> Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ?  params.maxinterceptxtot : 
              calcs.permitQuantitytot.toFixed(1)) : 0)}$$ </b>  <br>
    
              Abatement: A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  0 : 
              (params.maxinterceptxA - calcs.permitQuantityA).toFixed(1)) :  params.maxinterceptxA )};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  0 : 
              (params.maxinterceptx - calcs.permitQuantity).toFixed(1)) : params.maxinterceptx )}; 
              Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ? 0 : 
              (calcs.maxinterceptxtot - calcs.permitQuantitytot).toFixed(1)) : params.maxinterceptxtot )}$$  <br>
    
              &nbsp  - share of max.:  A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  0 : 
              ((params.maxinterceptxA - calcs.permitQuantityA) /params.maxinterceptxA) .toFixed(1)) :  1 )};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  0 : 
              ((params.maxinterceptx - calcs.permitQuantity)/params.maxinterceptx).toFixed(1)) : 1)};
              Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ? 0 : 
              ((calcs.maxinterceptxtot - calcs.permitQuantitytot)/calcs.maxinterceptxtot).toFixed(1)) : 1 )}$$
              <br> <br>
              Abatement costs for A: $\\\\ $${(calcs.permitACA.toFixed(1)  > 0 ?  calcs.permitACA.toFixed(1) : 0 )}<br>
              Abatement costs for B: $\\\\ $${(calcs.permitAC.toFixed(1)  > 0 ?  calcs.permitAC.toFixed(1) : 0 )}<br>
              <b> Total abatement costs: $\\\\ $${(calcs.permitACtot.toFixed(1)  > 0 ?  calcs.permitACtot.toFixed(1) : 0 )}$$ </b>
              `" 
              show: (calcs.permitQuantitytot > calcs.onlyB)  && (!params.showtax && params.showequilibrium )
   
     ## for uniform distribution
            - html: "` <u> With equal non-tradeable permits </u>  <br>
              Pollution  $P^{0}$:   A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  params.maxinterceptxA : 
              calcs.fixedquotaA.toFixed(1)) : 0)};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  params.maxinterceptx : 
              calcs.fixedquotaB.toFixed(1)) : 0)};
              <b> Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ?  params.maxinterceptxtot : 
              params.quotatot.toFixed(1)) : 0)}$$ </b>  <br>
    
              Abatement: A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  0 : 
              (params.maxinterceptxA - calcs.fixedquotaA).toFixed(1)) :  params.maxinterceptxA )};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  0 : 
              (params.maxinterceptx - calcs.fixedquotaB).toFixed(1)) : params.maxinterceptx )}; 
              Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ? 0 : 
              (calcs.maxinterceptxtot - params.quotatot).toFixed(1)) : params.maxinterceptxtot )}$$  <br>
    
              &nbsp  - share of max.:  A =$\\\\ $${(calcs.permitQuantityA  > 0 ?   
              (calcs.permitQuantityA >= params.maxinterceptxA ?  0 : 
              ((params.maxinterceptxA - calcs.fixedquotaA) /params.maxinterceptxA) .toFixed(1)) :  1 )};
              B = ${(calcs.permitQuantity  > 0 ?   
              (calcs.permitQuantity >= params.maxinterceptx ?  0 : 
              ((params.maxinterceptx - calcs.fixedquotaB)/params.maxinterceptx).toFixed(1)) : 1)};
              Tot = ${(calcs.permitQuantitytot  > 0 ?   
              (calcs.permitQuantitytot >= params.maxinterceptxtot ? 0 : 
              ((calcs.maxinterceptxtot - params.quotatot)/calcs.maxinterceptxtot).toFixed(1)) : 1 )}$$
              <br> <br>
              Abatement costs for A: $\\\\ $${(calcs.uniformACA.toFixed(1)  > 0 ?  calcs.uniformACA.toFixed(1) : 0 )}<br>
              Abatement costs for B: $\\\\ $${(calcs.uniformAC.toFixed(1)  > 0 ?  calcs.uniformAC.toFixed(1) : 0 )}<br>
              <b> Total abatement costs: $\\\\ $${(calcs.uniformACtot.toFixed(1)  > 0 ?  calcs.uniformACtot.toFixed(1) : 0 )}$$ </b>
              `" 
              show: (calcs.permitQuantitytot > calcs.onlyB)  && (!params.showtax && params.showuniform && !params.showequilibrium )
   
    
                                                    
                                                                
            
                           
                                               
</div> 
              
<br> <br> <br>
                  
Questions you can ask yourself with this graph: <br>
              - Is the uniform distribution of non-tradable permits efficient ? why not ?  <br>
              - Once trading is allowed, what determines the equilibrium permit price ? how is it affected by the total amount of permits issued ? by the shape of the abatement cost curves ? <br>
              - Can a similar outcome be obtained through a pollution tax?
              
              
<div class="watermark">Copyright (c) Justin Caron. Code generously created and shared by Christopher Makler / <a href="http://econgraphs.org">econgraphs.org</a></div>
</body>
</html>